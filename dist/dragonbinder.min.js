(()=>{function e(t){if("object"==typeof t&&null!==t&&!Object.isFrozen(t)){if(Array.isArray(t))for(let i=0,s=t.length;i<s;i++)e(t[i]);else{let i=Reflect.ownKeys(t);for(let s=0,r=i.length;s<r;s++)e(t[i[s]])}Object.freeze(t)}return t}function t({state:i,mutations:s,actions:r,getters:n,modules:o,shouldFreeze:l=!0,namespace:h,rootStore:a}={}){let u="function"==typeof i?i():i;this.state=new Proxy(u||{},{get:(t,i)=>(this.rootStore||this).init.modules[i]?t[i]:l?e(t[i]):t[i],set:(e,t,i)=>{this.isUnfrozen();let s=e[t];return e[t]=i,this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("set",t,i,s),!0},deleteProperty:(e,t)=>{this.isUnfrozen();let i=e[t];return delete e[t],this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("delete",t,i),!0}}),Object.defineProperty(this,"init",{value:{frozen:!0,plugins:[],modules:{},childModuleNamespaces:Object.keys(o||{}),listeners:{set:[],delete:[],beforecommit:[],commit:[],beforedispatch:[],dispatch:[],getter:[],addlistener:[],removelistener:[],plugin:[],registerModule:[],unregisterModule:[]},getters:n||{},mutations:s||{},actions:r||{}}}),this.getters=new Proxy(n||{},{get:(e,i)=>{try{let{store:e,key:s}=this.getStore(this,i);if(e instanceof t&&e.init.getters[s]){let t=e.init.getters[s](e.state,e.getters,this.state,this.getters);return this.namespace&&(i=`${this.namespace}.${i}`),(this.rootStore||this).trigger("getter",i,t),t}}catch(e){return}}}),Object.defineProperty(this,"rootStore",{value:a||null,enumerable:!0}),Object.defineProperty(this,"namespace",{value:h||null,enumerable:!0}),o&&Object.keys(o).forEach(e=>{let t=this.namespace?`${this.namespace}.${e}`:e;(this.rootStore||this).registerModule(t,o[e])})}if(t.prototype=t.fn={keyExists(e,t,i){if(!t[i])throw new Error(`The ${e} "${i}" does not exists.`)},isFunction(e,t){if("function"!=typeof t)throw new Error(`You need to provide a valid function as ${e}.`)},getStore(e,t){let i=t;if(i.indexOf(".")>-1){let t=i.split(".");i=t.pop();let s=t.join(".");this.keyExists("module",e.init.modules,s),e=e.init.modules[s]}return{store:e,key:i}},isUnfrozen(){if(this.init.frozen)throw new Error("You need to commit a mutation to change the state")},commit(e,...t){let{store:i,key:s}=this.getStore(this,e);this.keyExists("mutation",i.init.mutations,s),i.init.frozen=!1,this.trigger("beforecommit",e,...t),i.init.mutations[s](i.state,...t),this.trigger("commit",e,...t),i.init.frozen=!0},dispatch(e,...t){let{store:i,key:s}=this.getStore(this,e);return this.keyExists("action",i.init.actions,s),i.init.frozen=!1,this.trigger("beforedispatch",e,...t),Promise.resolve(i.init.actions[s](i,...t)).then(i=>(this.trigger("dispatch",e,...t),i))},trigger(e,...t){this.init.listeners[e].forEach(e=>e(this,...t))},on(e,t){return this.isFunction("listener",t),this.keyExists("event",this.init.listeners,e),-1===this.init.listeners[e].indexOf(t)&&(this.init.listeners[e].push(t),this.trigger("addlistener",e,t)),()=>this.off(e,t)},off(e,t){this.isFunction("listener",t),this.keyExists("event",this.init.listeners,e);let i=this.init.listeners[e].indexOf(t);i>-1&&(this.init.listeners[e].splice(i,1),this.trigger("removelistener",e,t))},use(e,...t){this.isFunction("plugin",e),-1===this.init.plugins.indexOf(e)&&(e(this,...t),this.init.plugins.push(e),this.trigger("plugin",e,...t))},registerModule(e,i){let s=this;if(s.init.modules[e])throw new Error(`A module with the namespace "${e}" is already registered.`);let r=new t(Object.assign({rootStore:s,namespace:e},i));s.init.frozen=!1,s.init.modules[e]=r,s.state[e]=r.state,s.init.frozen=!0,s.trigger("registerModule",e,i,r)},unregisterModule(e){let t=this,i=t.init.modules[e];i&&(i.init.childModuleNamespaces.forEach(i=>t.unregisterModule(`${e}.${i}`)),t.init.frozen=!1,delete t.init.modules[e],delete t.state[e],t.init.frozen=!0,t.trigger("unregisterModule",e,i))}},t.fn=t.prototype,"object"==typeof exports)var i=t;else("undefined"==typeof window?global:window).Dragonbinder=t;"undefined"!=typeof module?module.exports=i:self.Dragonbinder=i})();//# sourceMappingURL=dragonbinder.min.js.map