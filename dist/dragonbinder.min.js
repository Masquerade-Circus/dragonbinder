!function(){"use strict";function e(e,t,i){if(!t[i])throw new Error(`The ${e} "${i}" does not exists.`)}function t(e,t){if("function"!=typeof t)throw new Error(`You need to provide a valid function as ${e}.`)}function i(t,i){let s=i;if(s.indexOf(".")>-1){let i=s.split(".");s=i.pop();let r=i.join(".");e("module",t.init.modules,r),t=t.init.modules[r]}return{store:t,key:s}}function s(e={}){let{state:t,getters:r,modules:n,rootStore:o,namespace:h}=e,l="function"==typeof t?t():t;this.state=new Proxy(l||{},{get:(e,t)=>(this.rootStore||this).init.modules[t]?e[t]:this.deepFreeze(e[t]),set:(e,t,i)=>{this.isUnfrozen();let s=e[t];return e[t]=i,this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("set",t,i,s),!0},deleteProperty:(e,t)=>{this.isUnfrozen();let i=e[t];return delete e[t],this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("delete",t,i),!0}}),Object.defineProperty(this,"init",{value:{frozen:!0,plugins:[],modules:{},childModuleNamespaces:Object.keys(n||{}),listeners:{set:[],delete:[],beforecommit:[],commit:[],beforedispatch:[],dispatch:[],getter:[],addlistener:[],removelistener:[],plugin:[],registerModule:[],unregisterModule:[]},getters:e.getters||{},mutations:e.mutations||{},actions:e.actions||{}}}),this.getters=new Proxy(r||{},{get:(e,t)=>{try{let{store:e,key:r}=i(this,t);if(e instanceof s&&e.init.getters[r]){let i=e.init.getters[r](e.state,e.getters,this.state,this.getters);return this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("getter",t,i),i}}catch(e){return}}}),Object.defineProperty(this,"rootStore",{value:o||null,enumerable:!0}),Object.defineProperty(this,"namespace",{value:h||null,enumerable:!0}),n&&Object.keys(n).forEach(e=>{let t=this.namespace?`${this.namespace}.${e}`:e;(this.rootStore||this).registerModule(t,n[e])})}s.prototype=s.fn={isUnfrozen(){if(this.init.frozen)throw new Error("You need to commit a mutation to change the state")},deepFreeze(e){return Object.isFrozen(e)||(Object.getOwnPropertyNames(e).forEach(t=>"object"==typeof e[t]&&null!==e[t]&&this.deepFreeze(e[t])),Object.freeze(e)),e},commit(t,...s){let{store:r,key:n}=i(this,t);e("mutation",r.init.mutations,n),r.init.frozen=!1,this.trigger("beforecommit",t,...s),r.init.mutations[n](r.state,...s),this.trigger("commit",t,...s),r.init.frozen=!0},dispatch(t,...s){let{store:r,key:n}=i(this,t);return e("action",r.init.actions,n),r.init.frozen=!1,this.trigger("beforedispatch",t,...s),Promise.resolve(r.init.actions[n](r,...s)).then(e=>(this.trigger("dispatch",t,...s),e))},trigger(e,...t){this.init.listeners[e].forEach(e=>e(this,...t))},on(i,s){return t("listener",s),e("event",this.init.listeners,i),-1===this.init.listeners[i].indexOf(s)&&(this.init.listeners[i].push(s),this.trigger("addlistener",i,s)),()=>this.off(i,s)},off(i,s){t("listener",s),e("event",this.init.listeners,i);let r=this.init.listeners[i].indexOf(s);r>-1&&(this.init.listeners[i].splice(r,1),this.trigger("removelistener",i,s))},use(e,...i){t("plugin",e),-1===this.init.plugins.indexOf(e)&&(e(this,...i),this.init.plugins.push(e),this.trigger("plugin",e,...i))},registerModule(e,t){if(this.init.modules[e])throw new Error(`A module with the namespace "${e}" is already registered.`);let i=new s(Object.assign({rootStore:this,namespace:e},t));this.init.frozen=!1,this.init.modules[e]=i,this.state[e]=i.state,this.init.frozen=!0,this.trigger("registerModule",e,t,i)},unregisterModule(e){let t=this,i=t.init.modules[e];i&&(i.init.childModuleNamespaces.forEach(i=>t.unregisterModule(`${e}.${i}`)),t.init.frozen=!1,delete t.init.modules[e],delete t.state[e],t.init.frozen=!0,t.trigger("unregisterModule",e,i))}},s.fn=s.prototype,"object"==typeof exports?module.exports=s:("undefined"==typeof window?global:window).Dragonbinder=s}();//# sourceMappingURL=dragonbinder.min.js.map
