!function(){"use strict";function t(t,e,i){if(!e[i])throw new Error(`The ${t} "${i}" does not exists.`)}function e(t,e){if("function"!=typeof e)throw new Error(`You need to provide a valid function as ${t}.`)}function i(t={}){let{state:e,getters:i}=t;this.state=new Proxy(e||{},{get:(t,e)=>this.deepFreeze(t[e]),set:(t,e,i)=>{this.isUnfrozen();let s=t[e];return t[e]=i,this.trigger("set",e,i,s),!0},deleteProperty:(t,e)=>{this.isUnfrozen();let i=t[e];return delete t[e],this.trigger("delete",e,i),!0}}),Object.defineProperty(this,"init",{value:Object.assign({frozen:!0,plugins:[],listeners:{set:[],delete:[],beforecommit:[],commit:[],beforedispatch:[],dispatch:[],getter:[],addlistener:[],removelistener:[],plugin:[]}},t)}),this.getters=new Proxy(i||{},{get:(t,e)=>{if(t[e]){let i=t[e](this.state,this.getters);return this.trigger("getter",e,i),i}}})}i.prototype=i.fn={isUnfrozen(){if(this.init.frozen)throw new Error("You need to commit a mutation to change the state")},deepFreeze(t){return Object.isFrozen(t)||(Object.getOwnPropertyNames(t).forEach(e=>"object"==typeof t[e]&&null!==t[e]&&this.deepFreeze(t[e])),Object.freeze(t)),t},commit(e,...i){t("mutation",this.init.mutations,e),this.init.frozen=!1,this.trigger("beforecommit",e,...i),this.init.mutations[e](this.state,...i),this.trigger("commit",e,...i),this.init.frozen=!0},dispatch(e,...i){return t("action",this.init.actions,e),this.trigger("beforedispatch",e,...i),Promise.resolve(this.init.actions[e](this,...i)).then(t=>(this.trigger("dispatch",e,...i),t))},trigger(t,...e){this.init.listeners[t].forEach(t=>t(this,...e))},on(i,s){return e("listener",s),t("event",this.init.listeners,i),-1===this.init.listeners[i].indexOf(s)&&(this.init.listeners[i].push(s),this.trigger("addlistener",i,s)),()=>this.off(i,s)},off(i,s){e("listener",s),t("event",this.init.listeners,i);let r=this.init.listeners[i].indexOf(s);r>-1&&(this.init.listeners[i].splice(r,1),this.trigger("removelistener",i,s))},use(t,...i){e("plugin",t),-1===this.init.plugins.indexOf(t)&&(t(this,...i),this.init.plugins.push(t),this.trigger("plugin",t,...i))}},i.fn=i.prototype,"object"==typeof exports?module.exports=i:("undefined"==typeof window?global:window).Dragonbinder=i}();//# sourceMappingURL=dragonbinder.min.js.map
