!function(){"use strict";function e(t={}){let{state:i,getters:s,modules:r,rootStore:n,namespace:o}=t,h="function"==typeof i?i():i;this.state=new Proxy(h||{},{get:(e,t)=>(this.rootStore||this).init.modules[t]?e[t]:this.deepFreeze(e[t]),set:(e,t,i)=>{this.isUnfrozen();let s=e[t];return e[t]=i,this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("set",t,i,s),!0},deleteProperty:(e,t)=>{this.isUnfrozen();let i=e[t];return delete e[t],this.namespace&&(t=`${this.namespace}.${t}`),(this.rootStore||this).trigger("delete",t,i),!0}}),Object.defineProperty(this,"init",{value:{frozen:!0,plugins:[],modules:{},childModuleNamespaces:Object.keys(r||{}),listeners:{set:[],delete:[],beforecommit:[],commit:[],beforedispatch:[],dispatch:[],getter:[],addlistener:[],removelistener:[],plugin:[],registerModule:[],unregisterModule:[]},getters:t.getters||{},mutations:t.mutations||{},actions:t.actions||{}}}),this.getters=new Proxy(s||{},{get:(t,i)=>{try{let{store:t,key:s}=this.getStore(this,i);if(t instanceof e&&t.init.getters[s]){let e=t.init.getters[s](t.state,t.getters,this.state,this.getters);return this.namespace&&(i=`${this.namespace}.${i}`),(this.rootStore||this).trigger("getter",i,e),e}}catch(e){return}}}),Object.defineProperty(this,"rootStore",{value:n||null,enumerable:!0}),Object.defineProperty(this,"namespace",{value:o||null,enumerable:!0}),r&&Object.keys(r).forEach(e=>{let t=this.namespace?`${this.namespace}.${e}`:e;(this.rootStore||this).registerModule(t,r[e])})}e.prototype=e.fn={keyExists(e,t,i){if(!t[i])throw new Error(`The ${e} "${i}" does not exists.`)},isFunction(e,t){if("function"!=typeof t)throw new Error(`You need to provide a valid function as ${e}.`)},getStore(e,t){let i=t;if(i.indexOf(".")>-1){let t=i.split(".");i=t.pop();let s=t.join(".");this.keyExists("module",e.init.modules,s),e=e.init.modules[s]}return{store:e,key:i}},isUnfrozen(){if(this.init.frozen)throw new Error("You need to commit a mutation to change the state")},deepFreeze(e){return Object.isFrozen(e)||(Object.getOwnPropertyNames(e).forEach(t=>"object"==typeof e[t]&&null!==e[t]&&this.deepFreeze(e[t])),Object.freeze(e)),e},commit(e,...t){let{store:i,key:s}=this.getStore(this,e);this.keyExists("mutation",i.init.mutations,s),i.init.frozen=!1,this.trigger("beforecommit",e,...t),i.init.mutations[s](i.state,...t),this.trigger("commit",e,...t),i.init.frozen=!0},dispatch(e,...t){let{store:i,key:s}=this.getStore(this,e);return this.keyExists("action",i.init.actions,s),i.init.frozen=!1,this.trigger("beforedispatch",e,...t),Promise.resolve(i.init.actions[s](i,...t)).then(i=>(this.trigger("dispatch",e,...t),i))},trigger(e,...t){this.init.listeners[e].forEach(e=>e(this,...t))},on(e,t){return this.isFunction("listener",t),this.keyExists("event",this.init.listeners,e),-1===this.init.listeners[e].indexOf(t)&&(this.init.listeners[e].push(t),this.trigger("addlistener",e,t)),()=>this.off(e,t)},off(e,t){this.isFunction("listener",t),this.keyExists("event",this.init.listeners,e);let i=this.init.listeners[e].indexOf(t);i>-1&&(this.init.listeners[e].splice(i,1),this.trigger("removelistener",e,t))},use(e,...t){this.isFunction("plugin",e),-1===this.init.plugins.indexOf(e)&&(e(this,...t),this.init.plugins.push(e),this.trigger("plugin",e,...t))},registerModule(t,i){if(this.init.modules[t])throw new Error(`A module with the namespace "${t}" is already registered.`);let s=new e(Object.assign({rootStore:this,namespace:t},i));this.init.frozen=!1,this.init.modules[t]=s,this.state[t]=s.state,this.init.frozen=!0,this.trigger("registerModule",t,i,s)},unregisterModule(e){let t=this,i=t.init.modules[e];i&&(i.init.childModuleNamespaces.forEach(i=>t.unregisterModule(`${e}.${i}`)),t.init.frozen=!1,delete t.init.modules[e],delete t.state[e],t.init.frozen=!0,t.trigger("unregisterModule",e,i))}},e.fn=e.prototype,"object"==typeof exports?module.exports=e:("undefined"==typeof window?global:window).Dragonbinder=e}();//# sourceMappingURL=dragonbinder.min.js.map
