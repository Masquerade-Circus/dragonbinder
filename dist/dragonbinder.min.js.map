{"version":3,"file":"dragonbinder.min.js","sources":["../lib/index.js"],"sourcesContent":["function deepFreeze(obj) {\n  if (!Object.isFrozen(obj)) {\n    Object.getOwnPropertyNames(obj).forEach(\n      prop => typeof obj[prop] === 'object' && obj[prop] !== null && deepFreeze(obj[prop])\n    );\n    Object.freeze(obj);\n  }\n\n  return obj;\n}\n\nfunction createStore({ state, mutations, actions, getters }) {\n  let frozen = true;\n  let handlers = [];\n\n  function isUnfrozen() {\n    if (frozen) {\n      throw new Error('You need to commit a mutation to change the state');\n    }\n    return true;\n  }\n\n  function keyExists(type, object, key) {\n    if (!object[key]) {\n      throw new Error(`The ${type} \"${key}\" does not exists.`);\n    }\n\n    return true;\n  }\n\n  function isFunction(type, callback) {\n    if (typeof callback !== 'function') {\n      throw new Error(`You need to provide a valid function to ${type}.`);\n    }\n    return true;\n  }\n\n  let store = {\n    state: new Proxy(state || {}, {\n      get(state, prop) {\n        return deepFreeze(state[prop]);\n      },\n      set(state, prop, value) {\n        isUnfrozen();\n        let old = state[prop];\n        state[prop] = value;\n        handlers.forEach((callback) => callback(store.state, prop, value, old));\n\n        return true;\n      },\n      deleteProperty(state, prop) {\n        isUnfrozen();\n        delete state[prop];\n        return true;\n      }\n    }),\n    commit(mutation, ...args) {\n      keyExists('mutation', mutations, mutation);\n      frozen = false;\n      args.unshift(store.state);\n      mutations[mutation].apply(store, args);\n      frozen = true;\n\n    },\n    dispatch(action, ...args) {\n      keyExists('action', actions, action);\n      args.unshift(store);\n      return Promise.resolve(actions[action].apply(store, args));\n    },\n    getters: new Proxy(getters || {}, {\n      get(getters, getter) {\n        return getters[getter] && getters[getter](store.state, store.getters);\n      }\n    }),\n    subscribe(handler) {\n      isFunction('subscribe', handler);\n      if (handlers.indexOf(handler) === -1) {\n        handlers.push(handler);\n      }\n\n      return () => store.unsubscribe(handler);\n    },\n    unsubscribe(handler) {\n      isFunction('unsubscribe', handler);\n      let index = handlers.indexOf(handler);\n      if (index > -1) {\n        handlers.splice(index, 1);\n      }\n    }\n  };\n\n  return store;\n}\n\nif (typeof exports === 'object') {\n  module.exports = createStore;\n} else {\n  (typeof window === 'undefined' ? global : window).Store = createStore;\n}\n"],"names":["createStore","state","mutations","actions","getters","frozen","handlers","isUnfrozen","Error","keyExists","type","object","key","isFunction","callback","store","Proxy","get","prop","deepFreeze","obj","Object","isFrozen","getOwnPropertyNames","forEach","freeze","[object Object]","value","old","deleteProperty","mutation","args","unshift","apply","dispatch","action","Promise","resolve","getter","subscribe","handler","indexOf","push","unsubscribe","index","splice","exports","module","window","global","Store"],"mappings":"yBAWA,SAASA,GAAYC,MAAEA,EAAKC,UAAEA,EAASC,QAAEA,EAAOC,QAAEA,IAChD,IAAIC,GAAS,EACTC,EAAW,GAEf,SAASC,IACP,GAAIF,EACF,MAAM,IAAIG,MAAM,qDAElB,OAAO,EAGT,SAASC,EAAUC,EAAMC,EAAQC,GAC/B,IAAKD,EAAOC,GACV,MAAM,IAAIJ,aAAaE,MAASE,uBAGlC,OAAO,EAGT,SAASC,EAAWH,EAAMI,GACxB,GAAwB,mBAAbA,EACT,MAAM,IAAIN,iDAAiDE,MAE7D,OAAO,EAGT,IAAIK,EAAQ,CACVd,MAAO,IAAIe,MAAMf,GAAS,GAAI,CAC5BgB,IAAG,CAAChB,EAAOiB,KAvCjB,SAASC,EAAWC,GAQlB,OAPKC,OAAOC,SAASF,KACnBC,OAAOE,oBAAoBH,GAAKI,QAC9BN,GAA6B,iBAAdE,EAAIF,IAAoC,OAAdE,EAAIF,IAAkBC,EAAWC,EAAIF,KAEhFG,OAAOI,OAAOL,IAGTA,GAgCMD,CAAWlB,EAAMiB,IAE1BQ,IAAIzB,EAAOiB,EAAMS,GACfpB,IACA,IAAIqB,EAAM3B,EAAMiB,GAIhB,OAHAjB,EAAMiB,GAAQS,EACdrB,EAASkB,QAASV,GAAaA,EAASC,EAAMd,MAAOiB,EAAMS,EAAOC,KAE3D,GAETC,eAAc,CAAC5B,EAAOiB,KACpBX,WACON,EAAMiB,IACN,KAGXQ,OAAOI,KAAaC,GAClBtB,EAAU,WAAYP,EAAW4B,GACjCzB,GAAS,EACT0B,EAAKC,QAAQjB,EAAMd,OACnBC,EAAU4B,GAAUG,MAAMlB,EAAOgB,GACjC1B,GAAS,GAGX6B,SAAQ,CAACC,KAAWJ,KAClBtB,EAAU,SAAUN,EAASgC,GAC7BJ,EAAKC,QAAQjB,GACNqB,QAAQC,QAAQlC,EAAQgC,GAAQF,MAAMlB,EAAOgB,KAEtD3B,QAAS,IAAIY,MAAMZ,GAAW,GAAI,CAChCa,IAAG,CAACb,EAASkC,IACJlC,EAAQkC,IAAWlC,EAAQkC,GAAQvB,EAAMd,MAAOc,EAAMX,WAGjEmC,UAAUC,IACR3B,EAAW,YAAa2B,IACW,IAA/BlC,EAASmC,QAAQD,IACnBlC,EAASoC,KAAKF,GAGT,IAAMzB,EAAM4B,YAAYH,IAEjCd,YAAYc,GACV3B,EAAW,cAAe2B,GAC1B,IAAII,EAAQtC,EAASmC,QAAQD,GACzBI,GAAS,GACXtC,EAASuC,OAAOD,EAAO,KAK7B,OAAO7B,EAGc,iBAAZ+B,QACTC,OAAOD,QAAU9C,GAEE,oBAAXgD,OAAyBC,OAASD,QAAQE,MAAQlD"}