{"version":3,"file":"dragonbinder.min.js","sources":["../lib/index.js"],"sourcesContent":["function deepFreeze(obj) {\n  if (!Object.isFrozen(obj)) {\n    Object.getOwnPropertyNames(obj).forEach(prop => typeof prop === 'object' && prop !== null && deepFreeze(prop));\n    Object.freeze(obj);\n  }\n\n  return obj;\n}\n\nfunction createStore({ state, mutations, actions, getters }) {\n  let frozen = true;\n  let handlers = [];\n\n  function isUnfrozen() {\n    if (frozen) {\n      throw new Error('You need to commit a mutation to change the state');\n    }\n    return true;\n  }\n\n  function keyExists(type, object, key) {\n    if (!object[key]) {\n      throw new Error(`The ${type} \"${key}\" does not exists.`);\n    }\n\n    return true;\n  }\n\n  function isFunction(type, callback) {\n    if (typeof callback !== 'function') {\n      throw new Error(`You need to provide a valid function to ${type}.`);\n    }\n    return true;\n  }\n\n  let store = {\n    state: new Proxy(state || {}, {\n      get(state, prop) {\n        return deepFreeze(state[prop]);\n      },\n      set(state, prop, value) {\n        if (isUnfrozen()) {\n          let old = state[prop];\n          state[prop] = value;\n          handlers.forEach((callback) => callback(store.state, prop, value, old));\n        }\n\n        return true;\n      },\n      deleteProperty(state, prop) {\n        if (isUnfrozen()) {\n          delete state[prop];\n        }\n        return true;\n      }\n    }),\n    commit(mutation, ...args) {\n      if (keyExists('mutation', mutations, mutation)) {\n        frozen = false;\n        args.unshift(store.state);\n        mutations[mutation].apply(store, args);\n        frozen = true;\n      }\n    },\n    dispatch(action, ...args) {\n      args.unshift(store);\n      return Promise.resolve(keyExists('action', actions, action) ? actions[action].apply(store, args) : undefined);\n    },\n    getters: new Proxy(getters || {}, {\n      get(getters, getter) {\n        return getters[getter] && getters[getter](store.state, store.getters);\n      }\n    }),\n    subscribe(handler) {\n      if (isFunction('subscribe', handler) && handlers.indexOf(handler) === -1) {\n        handlers.push(handler);\n      }\n\n      return () => store.unsubscribe(handler);\n    },\n    unsubscribe(handler) {\n      if (isFunction('unsubscribe', handler)) {\n        let index = handlers.indexOf(handler);\n        if (index > -1) {\n          handlers.splice(index, 1);\n        }\n      }\n    }\n  };\n\n  return store;\n}\n\nif (typeof exports === 'object') {\n  module.exports = createStore;\n} else {\n  (typeof window === 'undefined' ? global : window).Store = createStore;\n}\n"],"names":["createStore","state","mutations","actions","getters","frozen","handlers","isUnfrozen","Error","keyExists","type","object","key","isFunction","callback","store","Proxy","get","prop","deepFreeze","obj","Object","isFrozen","getOwnPropertyNames","forEach","freeze","[object Object]","value","old","deleteProperty","mutation","args","unshift","apply","dispatch","action","Promise","resolve","undefined","getter","subscribe","handler","indexOf","push","unsubscribe","index","splice","exports","module","window","global","Store"],"mappings":"yBASA,SAASA,GAAYC,MAAEA,EAAKC,UAAEA,EAASC,QAAEA,EAAOC,QAAEA,IAChD,IAAIC,GAAS,EACTC,EAAW,GAEf,SAASC,IACP,GAAIF,EACF,MAAM,IAAIG,MAAM,qDAElB,OAAO,EAGT,SAASC,EAAUC,EAAMC,EAAQC,GAC/B,IAAKD,EAAOC,GACV,MAAM,IAAIJ,aAAaE,MAASE,uBAGlC,OAAO,EAGT,SAASC,EAAWH,EAAMI,GACxB,GAAwB,mBAAbA,EACT,MAAM,IAAIN,iDAAiDE,MAE7D,OAAO,EAGT,IAAIK,EAAQ,CACVd,MAAO,IAAIe,MAAMf,GAAS,GAAI,CAC5BgB,IAAG,CAAChB,EAAOiB,KArCjB,SAASC,EAAWC,GAMlB,OALKC,OAAOC,SAASF,KACnBC,OAAOE,oBAAoBH,GAAKI,QAAQN,GAAwB,iBAATA,GAA8B,OAATA,GAAiBC,EAAWD,IACxGG,OAAOI,OAAOL,IAGTA,GAgCMD,CAAWlB,EAAMiB,IAE1BQ,IAAIzB,EAAOiB,EAAMS,GACf,GAAIpB,IAAc,CAChB,IAAIqB,EAAM3B,EAAMiB,GAChBjB,EAAMiB,GAAQS,EACdrB,EAASkB,QAASV,GAAaA,EAASC,EAAMd,MAAOiB,EAAMS,EAAOC,IAGpE,OAAO,GAETC,eAAc,CAAC5B,EAAOiB,KAChBX,YACKN,EAAMiB,IAER,KAGXQ,OAAOI,KAAaC,GACdtB,EAAU,WAAYP,EAAW4B,KACnCzB,GAAS,EACT0B,EAAKC,QAAQjB,EAAMd,OACnBC,EAAU4B,GAAUG,MAAMlB,EAAOgB,GACjC1B,GAAS,IAGb6B,SAAQ,CAACC,KAAWJ,KAClBA,EAAKC,QAAQjB,GACNqB,QAAQC,QAAQ5B,EAAU,SAAUN,EAASgC,GAAUhC,EAAQgC,GAAQF,MAAMlB,EAAOgB,QAAQO,IAErGlC,QAAS,IAAIY,MAAMZ,GAAW,GAAI,CAChCa,IAAG,CAACb,EAASmC,IACJnC,EAAQmC,IAAWnC,EAAQmC,GAAQxB,EAAMd,MAAOc,EAAMX,WAGjEoC,UAAUC,IACJ5B,EAAW,YAAa4B,KAA2C,IAA/BnC,EAASoC,QAAQD,IACvDnC,EAASqC,KAAKF,GAGT,IAAM1B,EAAM6B,YAAYH,IAEjCf,YAAYe,GACV,GAAI5B,EAAW,cAAe4B,GAAU,CACtC,IAAII,EAAQvC,EAASoC,QAAQD,GACzBI,GAAS,GACXvC,EAASwC,OAAOD,EAAO,MAM/B,OAAO9B,EAGc,iBAAZgC,QACTC,OAAOD,QAAU/C,GAEE,oBAAXiD,OAAyBC,OAASD,QAAQE,MAAQnD"}